<!DOCTYPE html>
<html>
<head>
    <title>Quick Bug Report</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial; 
            padding: 20px; 
            background: #0a0a0a; 
            color: #fff; 
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: #0db9f2; margin-bottom: 20px; }
        .step { 
            background: #1a1a1a; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 8px; 
            border-left: 4px solid #0db9f2;
        }
        input, textarea { 
            width: 100%; 
            padding: 10px; 
            margin: 8px 0; 
            background: #0a0a0a; 
            border: 1px solid #333; 
            color: #fff; 
            border-radius: 4px;
        }
        button { 
            padding: 12px 24px; 
            background: #0db9f2; 
            color: #000; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: bold;
            font-size: 14px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover { background: #0aa3d9; }
        button:disabled { background: #555; cursor: not-allowed; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0db9f2; }
        pre { 
            background: #000; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto; 
            font-size: 11px;
            margin-top: 10px;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
            font-size: 13px;
        }
        .status.success { background: #0f3; color: #000; }
        .status.error { background: #f33; color: #fff; }
        .status.info { background: #0db9f2; color: #000; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Quick Bug Report</h1>
        
        <div class="step">
            <h3>Step 1: Login</h3>
            <div id="loginStatus" class="status info">Not logged in</div>
            <input type="text" id="user" value="lokzu2" placeholder="Username">
            <input type="password" id="pass" value="ml120998" placeholder="Password">
            <button onclick="doLogin()">LOGIN</button>
            <div id="loginResult"></div>
        </div>
        
        <div class="step">
            <h3>Step 2: Submit Bug Report</h3>
            <input type="text" id="title" value="Test bug" placeholder="Title">
            <textarea id="desc" rows="3" placeholder="Description">Testing bug report system</textarea>
            <button onclick="submitReport()" id="submitBtn" disabled>SUBMIT BUG REPORT</button>
            <div id="submitResult"></div>
        </div>
        
        <div class="step">
            <h3>Step 3: View in Admin</h3>
            <button onclick="window.open('http://localhost:3004', '_blank')">OPEN ADMIN PANEL</button>
        </div>
    </div>
    
    <script>
        let token = null;
        
        // Check if already logged in
        window.onload = function() {
            token = localStorage.getItem('token') || localStorage.getItem('adminToken');
            if (token) {
                document.getElementById('loginStatus').className = 'status success';
                document.getElementById('loginStatus').textContent = '‚úÖ Already logged in!';
                document.getElementById('submitBtn').disabled = false;
                console.log('Found token:', token.substring(0, 30) + '...');
            } else {
                console.log('No token found in localStorage');
            }
        };
        
        async function doLogin() {
            const user = document.getElementById('user').value;
            const pass = document.getElementById('pass').value;
            const result = document.getElementById('loginResult');
            
            result.innerHTML = '<p class="info">Logging in...</p>';
            console.log('Attempting login for:', user);
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: user, password: pass })
                });
                
                console.log('Login response status:', response.status);
                const data = await response.json();
                console.log('Login response data:', data);
                
                if (response.ok && data.token) {
                    token = data.token;
                    localStorage.setItem('token', token);
                    document.getElementById('loginStatus').className = 'status success';
                    document.getElementById('loginStatus').textContent = '‚úÖ Logged in as ' + data.user.username;
                    document.getElementById('submitBtn').disabled = false;
                    result.innerHTML = '<p class="success">‚úÖ Login successful!</p>';
                } else {
                    result.innerHTML = '<p class="error">‚ùå Login failed: ' + (data.error || 'Unknown error') + '</p>';
                }
            } catch (error) {
                console.error('Login error:', error);
                result.innerHTML = '<p class="error">‚ùå Error: ' + error.message + '</p>';
            }
        }
        
        async function submitReport() {
            if (!token) {
                alert('Please login first!');
                return;
            }
            
            const title = document.getElementById('title').value;
            const desc = document.getElementById('desc').value;
            const result = document.getElementById('submitResult');
            const btn = document.getElementById('submitBtn');
            
            btn.disabled = true;
            btn.textContent = 'SUBMITTING...';
            result.innerHTML = '<p class="info">Submitting...</p>';
            
            console.log('=== SUBMITTING BUG REPORT ===');
            console.log('Token:', token.substring(0, 30) + '...');
            console.log('Title:', title);
            console.log('Description:', desc);
            
            try {
                const response = await fetch('/api/reports/bug', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        title: title,
                        category: 'other',
                        description: desc
                    })
                });
                
                console.log('Submit response status:', response.status);
                const data = await response.json();
                console.log('Submit response data:', data);
                
                if (response.ok) {
                    result.innerHTML = '<p class="success">‚úÖ Bug report submitted!</p><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    document.getElementById('title').value = '';
                    document.getElementById('desc').value = '';
                } else {
                    result.innerHTML = '<p class="error">‚ùå Failed: ' + (data.error || 'Unknown error') + '</p><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                }
            } catch (error) {
                console.error('Submit error:', error);
                result.innerHTML = '<p class="error">‚ùå Error: ' + error.message + '</p>';
            } finally {
                btn.disabled = false;
                btn.textContent = 'SUBMIT BUG REPORT';
            }
        }
    </script>
</body>
</html>
