<!DOCTYPE html>
<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>App Settings (Dark Mode)</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols_Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script src="/js/clerk-config.js"></script>
<script src="/js/clerk-auth.js"></script>
<script src="/js/api.js"></script>
</head>
<body class="bg-background-dark text-slate-100 font-display antialiased selection:bg-primary selection:text-white">
<div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
<div class="relative w-full wave-bg pb-12 pt-safe-top overflow-hidden">
<div class="relative z-10 flex items-center px-6 py-4 justify-between pt-12">
<button onclick="window.location.href='/mobile/bio.html'" class="flex size-10 items-center justify-center rounded-full bg-surface-dark/40 text-white backdrop-blur-md hover:bg-surface-dark/70 transition-all active:scale-95">
<span class="material-symbols-outlined">arrow_back</span>
</button>
<h1 class="text-white text-lg font-bold tracking-tight">Settings</h1>
<button onclick="logout()" class="flex size-10 items-center justify-center rounded-full bg-red-500/20 text-red-400 backdrop-blur-md hover:bg-red-500/30 transition-all active:scale-95">
<span class="material-symbols-outlined">logout</span>
</button>
</div>
<div class="relative z-10 mt-2 px-6 flex flex-col items-center gap-5">
<div class="relative group">
<div class="bg-primary rounded-full h-24 w-24 flex items-center justify-center text-white text-4xl font-bold shadow-2xl" id="settingsAvatar">
U
</div>
</div>
<div class="text-center">
<h2 class="text-2xl font-bold text-white leading-tight" id="settingsName">Loading...</h2>
<div class="flex items-center justify-center gap-1 text-slate-400 text-sm font-medium mt-1">
<span id="settingsUsername">@user</span>
</div>
</div>
</div>
</div>
<div class="flex flex-col gap-5 px-4 pb-24 -mt-6 relative z-20">
<div class="flex flex-col gap-0 rounded-3xl overflow-hidden glass-panel shadow-lg shadow-black/20">
<div class="px-6 py-4 border-b border-slate-700/50 bg-slate-800/30">
<h3 class="text-xs font-bold uppercase tracking-wider text-slate-400">Account</h3>
</div>
<button onclick="window.location.href='/mobile/bio.html'" class="flex items-center justify-between px-6 py-4 border-b border-slate-700/30 hover:bg-white/5 transition-colors cursor-pointer group">
<div class="flex items-center gap-4">
<div class="flex items-center justify-center rounded-2xl bg-slate-800 text-slate-300 group-hover:text-primary group-hover:bg-primary/10 transition-colors h-10 w-10">
<span class="material-symbols-outlined">person</span>
</div>
<p class="text-base font-semibold leading-none text-slate-200">Edit Profile</p>
</div>
<span class="material-symbols-outlined text-slate-600 group-hover:text-primary transition-colors">chevron_right</span>
</button>
<button onclick="logout()" class="flex items-center justify-between px-6 py-4 hover:bg-red-500/5 transition-colors cursor-pointer group">
<div class="flex items-center gap-4">
<div class="flex items-center justify-center rounded-2xl bg-red-500/10 text-red-400 h-10 w-10">
<span class="material-symbols-outlined">logout</span>
</div>
<p class="text-base font-semibold leading-none text-red-400">Logout</p>
</div>
</button>
</div>
</div>
</div>

<script>
// Mobile Settings - Backend Integration
const authToken = localStorage.getItem('authToken');
if (!authToken) window.location.href = '/login.html';

async function loadSettings() {
    try {
        const response = await api.request('/api/profile');
        const profile = response.profile || response;
        
        document.getElementById('settingsName').textContent = profile.nickname || profile.username || 'User';
        document.getElementById('settingsUsername').textContent = `@${profile.username || 'user'}`;
        document.getElementById('settingsAvatar').textContent = (profile.nickname || profile.username || 'U')[0].toUpperCase();
        
    } catch (error) {
        console.error('Failed to load settings:', error);
    }
}

async function logout() {
    try {
        // Use Clerk's signOut if available
        if (window.clerkAuth && window.clerkAuth.signOutAndRedirect) {
            await window.clerkAuth.signOutAndRedirect('/auth/login.html');
        } else {
            // Fallback: clear storage and redirect
            localStorage.clear();
            sessionStorage.clear();
            window.location.href = '/auth/login.html';
        }
    } catch (error) {
        console.error('Logout error:', error);
        // Force logout even if there's an error
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = '/auth/login.html';
    }
}

loadSettings();
</script>
</body></html>
