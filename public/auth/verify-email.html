<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Email - Wave Messenger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="/css/theme.css" rel="stylesheet" />
    <link href="/css/theme-config.css" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#93c5fd',
                        tertiary: '#60a5fa'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-[#0a0a0a] min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Logo -->
        <div class="text-center mb-8">
            <div class="relative inline-block">
                <div class="absolute -inset-2 bg-blue-500/20 rounded-full blur-xl"></div>
                <h1 class="relative text-5xl font-bold text-white mb-2">ðŸŒŠ Wave</h1>
            </div>
            <p class="text-slate-500 mt-3">Email Verification</p>
        </div>

        <!-- Verification Card -->
        <div class="relative">
            <!-- Glow Effect -->
            <div class="absolute -inset-1 bg-gradient-to-r from-blue-600/20 via-blue-500/10 to-blue-600/20 rounded-3xl blur-xl opacity-50"></div>
            
            <div class="relative bg-[#0a0a0a] border border-white/10 rounded-2xl p-8 overflow-hidden">
                <!-- Header Gradient Line -->
                <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent"></div>

                <!-- Loading State -->
                <div id="loadingState" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent mb-4"></div>
                    <h2 class="text-xl font-bold text-white mb-2">Verifying Email...</h2>
                    <p class="text-slate-400 text-sm">Please wait</p>
                </div>

                <!-- Success State -->
                <div id="successState" class="hidden text-center py-8">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-green-500/20 border border-green-500/30 rounded-full mb-4">
                        <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">Email Verified!</h2>
                    <p class="text-slate-400 text-sm mb-6">Your email has been successfully verified.</p>
                    <a href="/chat.html" class="inline-block px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-semibold rounded-xl transition-all duration-200">
                        Go to Chat
                    </a>
                </div>

                <!-- Error State -->
                <div id="errorState" class="hidden text-center py-8">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-red-500/20 border border-red-500/30 rounded-full mb-4">
                        <svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-2">Verification Failed</h2>
                    <p id="errorText" class="text-red-400 text-sm mb-6">Invalid or expired verification link.</p>
                    <a href="/settings.html" class="inline-block px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-semibold rounded-xl transition-all duration-200">
                        Try Again
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const loadingState = document.getElementById('loadingState');
        const successState = document.getElementById('successState');
        const errorState = document.getElementById('errorState');
        const errorText = document.getElementById('errorText');

        async function verifyEmail() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (!token) {
                showError('No verification token provided');
                return;
            }

            try {
                const response = await fetch('/api/settings/email/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token })
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess();
                } else {
                    showError(data.error || 'Verification failed');
                }
            } catch (error) {
                showError('Network error. Please try again.');
            }
        }

        function showSuccess() {
            loadingState.classList.add('hidden');
            successState.classList.remove('hidden');
        }

        function showError(message) {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            errorText.textContent = message;
        }

        // Start verification
        verifyEmail();
    </script>
</body>
</html>
