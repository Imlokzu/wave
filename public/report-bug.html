<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Report a Bug - Wave Messenger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0db9f2",
                        "background-dark": "#101e23",
                        "surface-dark": "#16262c",
                    },
                    fontFamily: { "display": ["Inter", "sans-serif"] }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, rgba(13, 185, 242, 0.1) 0%, transparent 50%);
        }
    </style>
</head>
<body class="bg-background-dark text-slate-100 font-display relative overflow-x-hidden">
    <!-- Animated Background -->
    <div class="fixed inset-0 pointer-events-none opacity-30">
        <div class="absolute top-20 right-20 w-96 h-96 bg-primary/20 rounded-full blur-3xl animate-pulse"></div>
        <div class="absolute bottom-20 left-20 w-80 h-80 bg-cyan-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    </div>
    
    <div class="max-w-3xl mx-auto px-6 py-12 relative z-10">
        <div class="mb-12">
            <a href="/help.html" class="inline-flex items-center gap-2 text-primary hover:text-primary/80 transition-all hover:gap-3 mb-8">
                <span class="material-symbols-outlined">arrow_back</span>
                Back to Help Center
            </a>
            <div class="gradient-bg rounded-2xl p-8 border border-primary/20">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 rounded-xl bg-primary/20 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-3xl">bug_report</span>
                    </div>
                    <div>
                        <h1 class="text-5xl font-black text-white mb-2">Report a Bug</h1>
                        <p class="text-slate-400">Help us improve Wave by reporting issues</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-surface-dark/50 backdrop-blur-sm p-8 rounded-xl border border-slate-700/50 shadow-xl">
            <form id="bugReportForm" class="space-y-6">
                <div>
                    <label class="block text-white font-medium mb-2" for="bugTitle">Bug Title *</label>
                    <input id="bugTitle" type="text" required class="w-full bg-background-dark border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-primary focus:ring-1 focus:ring-primary" placeholder="Brief description of the issue"/>
                </div>

                <div>
                    <label class="block text-white font-medium mb-2" for="bugCategory">Category *</label>
                    <select id="bugCategory" required class="w-full bg-background-dark border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-primary focus:ring-1 focus:ring-primary">
                        <option value="">Select a category</option>
                        <option value="messaging">Messaging</option>
                        <option value="ai">AI Assistant</option>
                        <option value="feed">Feed</option>
                        <option value="profile">Profile</option>
                        <option value="settings">Settings</option>
                        <option value="authentication">Login/Signup</option>
                        <option value="performance">Performance</option>
                        <option value="ui">UI/Design</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div>
                    <label class="block text-white font-medium mb-2" for="bugDescription">Description *</label>
                    <textarea id="bugDescription" required rows="6" class="w-full bg-background-dark border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-primary focus:ring-1 focus:ring-primary resize-none" placeholder="Describe what happened, what you expected, and steps to reproduce..."></textarea>
                </div>

                <div>
                    <label class="block text-white font-medium mb-2" for="bugBrowser">Browser & Device</label>
                    <input id="bugBrowser" type="text" class="w-full bg-background-dark border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-primary focus:ring-1 focus:ring-primary" placeholder="e.g., Chrome 120 on Windows 11"/>
                </div>

                <div>
                    <label class="block text-white font-medium mb-2" for="bugEmail">Email (optional)</label>
                    <input id="bugEmail" type="email" class="w-full bg-background-dark border border-slate-700 rounded-lg px-4 py-3 text-white focus:border-primary focus:ring-1 focus:ring-primary" placeholder="your@email.com"/>
                    <p class="text-slate-400 text-sm mt-1">We'll contact you if we need more information</p>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-primary text-black px-6 py-3 rounded-lg font-semibold hover:bg-primary/90 transition-colors flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined">send</span>
                        Submit Report
                    </button>
                    <button type="reset" class="px-6 py-3 rounded-lg border border-slate-700 text-white hover:bg-surface-dark transition-colors">
                        Clear
                    </button>
                </div>
            </form>

            <div id="successMessage" class="hidden mt-6 p-4 bg-green-500/20 border border-green-500/50 rounded-lg text-green-400">
                <div class="flex items-center gap-2">
                    <span class="material-symbols-outlined">check_circle</span>
                    <span>Thank you! Your bug report has been submitted.</span>
                </div>
            </div>
        </div>

        <div class="mt-8 bg-primary/10 border border-primary/30 rounded-xl p-6 backdrop-blur-sm">
            <h3 class="text-white font-bold mb-3 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">lightbulb</span>
                Tips for reporting bugs
            </h3>
            <ul class="space-y-2 text-slate-300 text-sm">
                <li>• Be specific about what you were doing when the bug occurred</li>
                <li>• Include steps to reproduce the issue</li>
                <li>• Mention your browser, device, and operating system</li>
                <li>• Attach screenshots if possible (you can paste them in the description)</li>
            </ul>
        </div>

        <div class="mt-12 pt-8 border-t border-slate-700/50 text-center">
            <div class="flex items-center justify-center gap-2 mb-4">
                <img src="/nobackwave.png" alt="Wave" class="h-8 w-8 object-contain opacity-50" />
                <span class="text-slate-500 font-semibold">Wave Messenger</span>
            </div>
            <p class="text-slate-400 text-sm">© 2025 Wave Messenger. All rights reserved.</p>
        </div>
    </div>

    <script src="/js/update-checker.js"></script>
    <script>
        // Check login status on page load - check both token locations
        const token = localStorage.getItem('token') || localStorage.getItem('adminToken');
        const loginStatus = document.createElement('div');
        loginStatus.className = 'mb-4 p-3 rounded-lg text-sm flex items-center gap-2';
        
        if (token) {
            loginStatus.className += ' bg-green-500/20 border border-green-500/50 text-green-400';
            loginStatus.innerHTML = '<span class="material-symbols-outlined text-sm">check_circle</span> <span>You are logged in. Bug reports will be submitted to the admin panel.</span>';
        } else {
            loginStatus.className += ' bg-yellow-500/20 border border-yellow-500/50 text-yellow-400';
            loginStatus.innerHTML = '<span class="material-symbols-outlined text-sm">info</span> <span>You are not logged in. Bug report will be copied to clipboard. <a href="/login.html" class="underline font-bold">Login here</a></span>';
        }
        
        document.getElementById('bugReportForm').insertAdjacentElement('beforebegin', loginStatus);
        
        document.getElementById('bugReportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const originalHTML = submitButton.innerHTML;
            submitButton.disabled = true;
            submitButton.innerHTML = '<svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Submitting...';
            
            try {
                const token = localStorage.getItem('token') || localStorage.getItem('adminToken');
                
                // Collect bug report text
                const bugReport = {
                    title: document.getElementById('bugTitle').value,
                    category: document.getElementById('bugCategory').value,
                    description: document.getElementById('bugDescription').value,
                    browser: document.getElementById('bugBrowser').value,
                    email: document.getElementById('bugEmail').value,
                    timestamp: new Date().toISOString()
                };
                
                // If logged in, submit to API
                if (token) {
                    console.log('=== SUBMITTING BUG REPORT ===');
                    console.log('Token:', token.substring(0, 20) + '...');
                    console.log('URL:', '/api/reports/bug');
                    console.log('Data:', {
                        title: bugReport.title,
                        category: bugReport.category,
                        description: bugReport.description
                    });
                    
                    const response = await fetch('/api/reports/bug', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            title: bugReport.title,
                            category: bugReport.category,
                            description: bugReport.description + 
                                '\n\nBrowser/Device: ' + bugReport.browser +
                                (bugReport.email ? '\nContact: ' + bugReport.email : '')
                        })
                    });
                    
                    console.log('Response status:', response.status);
                    console.log('Response OK:', response.ok);
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('API Error:', errorData);
                        alert('Error: ' + JSON.stringify(errorData));
                        throw new Error(errorData.error || 'Failed to submit bug report');
                    }
                    
                    const result = await response.json();
                    console.log('=== SUCCESS ===');
                    console.log('Bug report submitted successfully:', result);
                    
                    // Show success message
                    document.getElementById('successMessage').innerHTML = `
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined">check_circle</span>
                            <span>Thank you! Your bug report has been submitted and is visible in the admin panel.</span>
                        </div>
                    `;
                } else {
                    // Not logged in - just show the text to copy
                    const reportText = `Bug Report
Title: ${bugReport.title}
Category: ${bugReport.category}
Description: ${bugReport.description}
Browser/Device: ${bugReport.browser}
${bugReport.email ? 'Contact: ' + bugReport.email : ''}
Submitted: ${bugReport.timestamp}`;
                    
                    // Copy to clipboard
                    await navigator.clipboard.writeText(reportText);
                    
                    // Show success message
                    document.getElementById('successMessage').innerHTML = `
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined">content_copy</span>
                            <span>Bug report copied to clipboard! Please send it to the admin or <a href="/login.html" class="underline font-bold">login</a> to submit directly.</span>
                        </div>
                    `;
                }
                
                document.getElementById('successMessage').classList.remove('hidden');
                this.reset();
                
                // Hide success message after 5 seconds
                setTimeout(() => {
                    document.getElementById('successMessage').classList.add('hidden');
                }, 5000);
            } catch (error) {
                console.error('Error submitting bug report:', error);
                alert('Failed to submit bug report: ' + error.message);
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = originalHTML;
            }
        });
    </script>
</body>
</html>
