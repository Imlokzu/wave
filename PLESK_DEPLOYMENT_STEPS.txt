â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  WAVE APP - PLESK DEPLOYMENT GUIDE (FINAL VERSION)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ WHAT TO UPLOAD TO PLESK (api.metrocraft.eu)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Upload ONLY these files/folders from the "backend" folder:

âœ… backend/dist/              (compiled JavaScript - REQUIRED)
âœ… backend/node_modules/      (dependencies - REQUIRED)
âœ… backend/package.json       (REQUIRED)
âœ… backend/package-lock.json  (REQUIRED)
âœ… backend/.env               (environment variables - REQUIRED)
âœ… passenger-app.js           (from root folder - REQUIRED)

âŒ DO NOT upload:
   - backend/src/ (TypeScript source - not needed)
   - backend/app.js (old file - not needed)
   - Any other files


ğŸ”§ PLESK NODE.JS SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Go to: Websites & Domains â†’ api.metrocraft.eu â†’ Node.js

Set these values:

1. Application mode: Production
2. Application root: /httpdocs (or wherever you uploaded files)
3. Application startup file: passenger-app.js
4. Application URL: https://api.metrocraft.eu
5. Node.js version: Latest available (18.x or higher)

âš ï¸ IMPORTANT: DO NOT set a custom port! Passenger handles this automatically.


ğŸ“ VERIFY .ENV FILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Make sure backend/.env contains:

PORT=3001
NODE_ENV=production
FRONTEND_URL=https://metrocraft.eu
API_URL=https://api.metrocraft.eu
ADMIN_URL=https://admin.metrocraft.eu
SUPABASE_URL=https://ocvusoidmvjlbssblnxw.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9jdnVzb2lkbXZqbGJzc2Jsbnh3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NzAzODcsImV4cCI6MjA4MTU0NjM4N30.O6YZPYdSWfDME7ElzzDcpFg5DL1YUSrMc9yulDdyHB0
SUPABASE_BUCKET=files
IMGBB_API_KEY=1606b78ff8eef2cbbbb20bba455dfdeb
OPENAI_API_KEY=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
LANGSEARCH_API_KEY=sk-be0d888dbef54155b92b1232b3dcc28c


ğŸ” AFTER UPLOADING - CHECK LOGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Go to: Websites & Domains â†’ api.metrocraft.eu â†’ Protokolle (Logs)

Look for these SUCCESS messages:
âœ… "Wave API loaded successfully for Passenger"
âœ… "WaveChat Server loaded for Passenger"
âœ… "Passenger will handle port binding"

If you see ERRORS, common issues:
âŒ "Cannot find module" â†’ node_modules missing, run "npm install" in Plesk
âŒ "Missing SUPABASE_URL" â†’ .env file missing or wrong location
âŒ "Permission denied" â†’ File permissions issue, contact Plesk support


ğŸŒ NGINX CONFIGURATION (OPTIONAL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you need WebSocket support, add this to nginx settings:

Go to: Websites & Domains â†’ api.metrocraft.eu â†’ Apache & nginx Settings
â†’ Additional nginx directives:

location /socket.io/ {
    proxy_pass http://127.0.0.1:$PASSENGER_PORT;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

Note: Passenger sets $PASSENGER_PORT automatically


ğŸ§ª TESTING THE DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Test health endpoint:
   https://api.metrocraft.eu/health
   
   Should return:
   {"status":"ok","timestamp":"...","services":{...}}

2. Test from frontend:
   Open https://metrocraft.eu
   Try to login with: lokzu2 / ml120998

3. Check admin panel:
   https://admin.metrocraft.eu
   Login with same credentials


âš ï¸ CRITICAL NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. The server code now detects Passenger automatically and won't try to
   bind to a port (Passenger does this for you)

2. If you see "upstream timed out" errors, the app is taking too long to
   start. Check logs for the real error.

3. WebSocket (Socket.IO) may not work perfectly with Passenger. If chat
   doesn't work, you may need to deploy the backend to Railway.app or
   similar Node.js hosting instead.

4. SSL certificate: Make sure "Let's Encrypt" is enabled for api.metrocraft.eu
   in Plesk. iOS requires HTTPS for API calls.


ğŸ†˜ IF IT STILL DOESN'T WORK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Alternative: Deploy backend to Railway.app (free tier)

1. Go to railway.app
2. Create new project from GitHub
3. Add environment variables from .env
4. Railway will auto-detect Node.js and run "npm start"
5. Get the Railway URL (e.g., https://your-app.railway.app)
6. Update frontend files to use Railway URL instead of api.metrocraft.eu

This is easier than Plesk for Node.js apps with WebSocket!


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  END OF GUIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
